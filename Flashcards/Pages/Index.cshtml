@page
@model Flashcards.Pages.IndexModel
@{
    ViewData["Title"] = "Home Page";
}

<div class="text-center">
    <h1 class="display-4">Flashcards</h1>
    <div>
        @foreach (var flashcard in Model.Flashcards)
        {
            <div class="flashcard" data-snapshot-name="@flashcard.SnapshotPath">
                <h2>@flashcard.Title</h2>
                <p>@flashcard.Description</p>
                <button class="btn btn-primary" onclick="startSnapshot('@flashcard.Id')">Start Snapshot</button>
            </div>
        }
    </div>
</div>

@section Scripts {
    <script>
        function startSnapshot(flashcardId) {
            console.log(`Starting snapshot for flashcard ID: ${flashcardId}`);
            fetch(`/api/vm/start-snapshot/${flashcardId}`, {
                method: 'POST'
            })
                .then(response => {
                    console.log('Fetch response:', response);
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('Fetch response data:', data);
                    alert(data.message);
                })
                .catch(error => {
                    console.error('Fetch error:', error);
                    alert('There was a problem with the fetch operation: ' + error.message);
                });
        }
    </script>
}